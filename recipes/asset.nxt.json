{
  "symbol":"nxt",
  "name":"NXT",
  "module":"quartz",
  "mode":"nxt.main",
  "addressRegex":"^NXT(-[A-HJ-N-P-Z2-9]{4}){4}[A-HJ-N-P-Z2-9]$",
  "factor":8,
  "fee":1,
  "fee-symbol":"nxt",
  "chain":"",
  "host":["http://nxt01.now.im:7876/nxt","https://enricoip.no-ip.biz:7876/nxt"],
  "broken-host-illegal-certificate" : ["https://nxt1.y.cz:7876/nxt","https://nxt2.y.cz:7876/nxt","https://nxt2.utut.org:7876/nxt"],
  "unresponsive-host":["https://nxt.utila.nl:7876/nxt","http://gtwins2.f3322.net:7876/nxt"],
  "cache":15000,
  "throttle":5,
  "genesisBlockTime":1385294400,
  "quartz":{
    "balance":[
      "data '$symbol'",
      "find '.' 1 3",
      "call 'tokenBalance/$1'",
      "jump 2",
      "call 'mainBalance/$1'"
    ],
    "mainBalance":[
      "@retryLoop",
      "data $name",
      "flow NXT 1 3",
      "data '?requestType=getBalance&account=$1'",
      "jump 2",
      "data '?requestType=getBalance&account=$1&chain=$chain'",
      "curl asset://$symbol $ GET {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "tran '.unconfirmedBalanceNQT' @returnBalance 1",
      "tran '.errorCode' 1 @retry",
      "flow 5 1 @retry",
      "done 0",
      "atom",
      "@retry",
      "logs 2 'module nxt: bad RPC response, retrying request...'",
      "wait 1500",
      "loop @retryLoop 'retries' '<5' '1'",
      "fail '0'",
      "@returnBalance",
      "atom",
      "done"
    ],
    "tokenBalance":[
      "@tokenRetryLoop",
      "poke address '$1'",
      "data '$symbol'",
      "find 'burst.' @burstToken @otherToken",
      "@otherToken",
      "curl asset://$symbol ?requestType=getAccount&account=$address&includeAssets=true&includeCurrencies=true GET {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "jump @next",
      "@burstToken",
      "curl asset://$symbol ?requestType=getAccount&account=$address GET {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "@next",
      "tran '.unconfirmedAssetBalances' @returnTokenBalance 1",
      "# retries are now handled by API queue, disabled retry loop below",
      "#logs 2 'module nxt: bad RPC response, retrying request...'",
      "#wait 1500",
      "#loop @tokenRetryLoop 'retries' '<5' '1'",
      "data '0'",
      "@returnTokenBalance",
      "find {asset:'$contract'} @tokenBalance 1",
      "data '0'",
      "atom",
      "done",
      "@tokenBalance",
      "tran '[0].unconfirmedBalanceQNT' 2 1",
      "fail",
      "atom",
      "done"
    ],
    "unspent":[
      "data '$symbol'",
      "find '.' 1 3",
      "call 'tokenUnspent/$1/$2/$3/$4/$5'",
      "jump @done",
      "call 'mainUnspent/$1/$2/$3/$4/$5'",
      "@done",
      "done"
    ],
    "mainUnspent":[
      "call 'fee'",
      "poke 'numFee'",
      "atom true",
      "poke 'txFee'",
      "data '$2'",
      "math '-$numFee'",
      "atom true",
      "poke 'txAmount'",
      "data $5",
      "poke message",
      "void 1 2",
      "poke message ''",
      "data $name",
      "flow NXT 1 4",
      "data 'recipient=$3&publicKey=$4&amountNQT=$txAmount&feeNQT=$txFee&deadline=300&doNotSign=1&broadcast=false&message=$message'",
      "curl asset://$symbol ?requestType=sendMoney POST {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "jump 3",
      "data 'recipient=$3&publicKey=$4&amountNQT=$txAmount&feeNQT=$txFee&deadline=300&doNotSign=1&broadcast=false&message=$message'",
      "curl asset://$symbol ?requestType=sendMoney&chain=$chain POST {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "poke 'result'",
      "tran '.errorDescription' 1 2",
      "fail",
      "data $result",
      "done"
    ],
    "tokenUnspent":[
      "call 'fee'",
      "poke 'numFee'",
      "atom true",
      "poke 'txFee'",
      "data '$2'",
      "atom true",
      "poke 'txAmount'",
      "data $5",
      "poke message",
      "void 1 2",
      "poke message ''",
      "data 'recipient=$3&asset=$contract&publicKey=$4&quantityQNT=$txAmount&feeNQT=$txFee&deadline=300&doNotSign=1&broadcast=false&message=$message'",
      "poke unspentData",
      "data $name",
      "flow NXT 1 4",
      "peek unspentData",
      "curl asset://$symbol ?requestType=transferAsset POST {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "jump 3",
      "peek unspentData",
      "curl asset://$symbol ?requestType=transferAsset&chain=$chain POST {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "tran '.errorDescription' 1 2",
      "fail",
      "done"
    ],
    "push":[
      "@retryLoop",
      "data $name",
      "flow NXT 1 5",
      "data transactionBytes=$1",
      "curl asset://$symbol ?requestType=broadcastTransaction POST {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "tran '.transaction' 1 @fail",
      "done",
      "data transactionBytes=$1",
      "curl asset://$symbol ?requestType=broadcastTransaction&chain=$chain POST {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "tran '.fullHash' 1 @fail",
      "done",
      "@fail",
      "logs 2,'module nxt: bad RPC response, retrying request...'",
      "wait 1500",
      "loop @retryLoop 'retries' '<5' '1'",
      "fail 'Error: $symbol network not responding. Cannot push transaction!'"
    ],
    "history" : [
      "poke count $2 12",
      "poke offset $3 0",
      "data $name",
      "flow NXT 1 3",
      "data '?requestType=getBlockchainTransactions&account=$1&firstIndex=$offset&lastIndex=$until'",
      "jump 2",
      "data '?requestType=getBlockchainTransactions&account=$1&chain=$chain&firstIndex=$offset&lastIndex=$until'",
      "with until [math,'$offset+$count']",
      "curl asset://$symbol $ GET {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'}",
      "tran '.transactions' 2 1",
      "fail 'Bad response from NXT node!'",
      "sort ['.timestamp',num,desc]",
      "poke txData",
      "data $name",
      "flow NXT 1 4",
      "peek txData",
      "tran '[].transaction'",
      "jump 3",
      "peek txData",
      "tran '[].fullHash'",
      "done"
    ],
    "transactionData" : [
      "data $name",
      "flow NXT 1 3",
      "data '?requestType=getTransaction&transaction=$1'",
      "jump 2",
      "data '?requestType=getTransaction&chain=$chain&fullHash=$1'",
      "curl asset://$symbol $ GET {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'} 2 1",
      "fail 'Error retrieving data!'",
      "have '.confirmations' 2 1",
      "fail 'Transaction does not exist!'",
      "# withMessage is true to retrieve only transactions having a message attachment, either non-encrypted or decryptable by the account (optional)"
    ],
    "transaction" : [
      "call 'transactionData/$1'",
      "data $",
      "with reformatAmount [data,'${.amountNQT}'] [atom]",
      "with reformatFee [data,'${.feeNQT}'] [atom]",
      "with sender [data,'${.senderRS}'] [flow,'undefined',1,2] [data,'${.sender}'] [done]",
      "with recipient [data,'${.recipientRS}'] [flow,'undefined',1,2] [data,'${.recipient}'] [done]",
      "with .timestamp math +$genesisBlockTime",
      "tran { id:'$1', timestamp:'.timestamp', height:'.height', amount:'$reformatAmount', symbol:'$symbol', fee:'$reformatFee', 'fee-symbol':'${fee-symbol}', source:'$sender', target:'$recipient', confirmed:'.confirmations' } 2 1",
      "fail 'Could not read transaction!'"
    ],
    "attachment" : [
      "call 'transactionData/$1'",
      "tran '.attachment' 2 1",
      "fail 'Could not read transaction!'",
      "done"
    ],
    "message" : [
      "call 'attachment/$1'",
      "tran .message 2 1",
      "done ''",
      "code hex utf8",
      "done"
    ],
    "sample" : [
      "done {address:'NXT-4RU9-TNCT-F3MU-8952K',transaction:'13821793329980543744',publicKey:'32f5fa059b39fae92e41fee6606c5afa4db80d426532fa94f50415c062794c4b'}"
    ],
    "test" :[
      "done {}",
      "with transactionKey [data, '$name'] [flow, IGNIS, 1, 3] [data, 'fxtTransaction'] [done] [data, 'transaction'] [done]"
    ]
  }
}
