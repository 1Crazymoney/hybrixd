{
  "engine":"electrum-tcp",
  "name":"Electrum TCP connector",
  "module":"quartz",
  "cache":1000,
  "throttle":10,
  "timeout":24000,
  "longtimeout":60000,
  "confirmsRequired":6,
  "utxo_unspent_prefix":"76a914",
  "utxo_unspent_suffix":"88ac",
  "trimAddrHexL":"2",
  "trimAddrHexR":"-8",
  "cron":600,
  "quartz":{
    "peers" : [
      "curl 'asset://$symbol','','',{'jsonrpc':'2.0','id':0,'method':'server.peers.subscribe','params':[]},{},{'timeout':$longtimeout}",
      "tran '.result' 2 1",
      "data []",
      "done"
    ],
    "unspent" : [
      "poke('inputval','99999999999999999999')",
      "test($2,1,2)",
      "poke('inputval','$2')",
      "data('$1')",
      "code('base58','hex')",
      "pull($trimAddrHexL,$trimAddrHexR)",
      "poke('script','$utxo_unspent_prefix'+data+'$utxo_unspent_suffix')",
      "time($longtimeout)",
      "curl('asset://$symbol','','',{'jsonrpc':'2.0','id':0,'method':'blockchain.address.listunspent','params':['$1']},{},{'timeout':$longtimeout})",
      "tran('.result',2,1)",
      "fail('Bad input unspents from Electrum!')",
      "each(data,'unspent_tran')",
      "sort('.amount')",
      "scan('cnt<($inputval+val.amount)','+val.amount')",
      "poke('selected')",
      "tran('[].amount',2,1)",
      "data([])",
      "math('+')",
      "math('-$inputval')",
      "test(data<0,1,2)",
      "data('0')",
      "form()",
      "done({unspents:$selected,change:data})"
    ],
    "unspent_tran" : [
      "data(data.value)",
      "poke('unspent')",
      "tran('.value',2,1)",
      "data(0)",
      "atom()",
      "poke('amount')",
      "peek('unspent')",
      "tran({script:'$parent::script',amount:'$amount',txid:'.tx_hash',txn:'.tx_pos'},2,1)",
      "fail('Bad input unspents from Electrum!')",
      "done()"
    ],
    "balance" : [
      "time($timeout)",
      "curl('asset://$symbol','','',{'jsonrpc':'2.0','id':0,'method':'blockchain.address.get_balance','params':['$1']})",
      "tran({confirmed:'.result.confirmed',unconfirmed:'.result.unconfirmed'},3,1)",
      "data(0)",
      "jump(3)",
      "time($cache,data)",
      "math(data.confirmed+'+'+data.unconfirmed)",
      "atom()",
      "pass()"
    ],
    "push" : [
      "time($timeout)",
	  "curl('asset://$symbol','','',{'jsonrpc':'2.0','id':0,'method':'blockchain.transaction.broadcast','params':['$1']})",
      "tran('.result',4,1)",
      "tran('.error',1,2)",
      "fail(data.message)",
      "fail('Bad transaction result!')",
      "done()"
    ],
    "factor" : [
      "pass('$factor')"
    ],
    "transaction" : [
      "time($timeout)",
      "curl('asset://$symbol','','',{'jsonrpc':'2.0','id': 1, 'method': 'blockchain.transaction.get', 'params': ['$1'] })",
      "tran('.result',2,1)",
      "stop(1,'No result')",
      "pass(data)"
    ],
    "sample" : [
      "stop(0,{address:'1F1tAaz5x1HUXrCNLbtMDqcw6o5GNn4xqX',transaction:'2c0832c153cf33327dae0e95a3bc39f4b02ae887725a32c07b1be47a2faffc55'})"
    ],
    "history" : [
      "rout('/source/blockexplorer/$symbol/history/$1')"
    ],
    "contract" : [
      "done('$contract')"
    ],
    "fee" : [
      "hook('$fee',0)",
	  "peek('local::fee')",
      "done()"
    ],
    "init" : [
      "test('$symbol'==='undefined',2)",
      "call('getFee')"
    ],
    "cron" : [
      "test('$symbol'==='undefined',2)",
      "call('getFee')"
    ],
    "getFee" : [
      "time($timeout)",
      "curl('asset://$symbol','','',{'jsonrpc':'2.0','id': 1, 'method': 'blockchain.estimatefee', 'params': ['$confirmsRequired'] })",
      "tran('.result',1,4)",
      "test(data>0,1,3)",
      "poke('local::fee')",
      "done()"
    ]
  }
}
