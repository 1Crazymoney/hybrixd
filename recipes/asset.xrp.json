{
  "symbol":"xrp",
  "name":"Ripple",
  "module":"quartz",
  "fee-symbol":"drops",
  "fee":"0.00001",
  "fee-factor":0,
  "cron":300,
  "mode":"xrp",
  "contract":"",
  "factor":6,
  "host":"wss://s2.ripple.com:443",
  "cache":15000,
  "throttle":5,
  "quartz" : {
    "init" : [
      "data {'id': 1,'command': 'server_info'}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran '.status' @status @fail",
      "@status",
      "flow 'success' @end @fail",
      "@fail",
      "fail 'No result!'",
      "@end",
      "data {'id': 1,'command': 'server_info'}",
      "curl 'asset://$symbol' '' 'POST'",
      "done()"
    ],
    "fee-factor" : [
      "pass '$fee-factor'"
    ],
    "balance" : [
      "data '$symbol'",
      "take 3",
      "flow '' @balance @tokenBalance",
      "@balance",
      "data {'id': 2,'command': 'account_info','account': '$1','strict': true,'ledger_index': 'current','queue': true}",
      "curl 'asset://$symbol' '' 'POST'",
      "poke 'local::curlResult'",
      "tran '.status' 1 @fail",
      "flow 'success' 1 @fail",
      "data {'id': 2,'command': 'account_info','account': '$1','strict': true,'ledger_index': 'current','queue': true}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran '.result.account_data.Balance' @end @fail",
      "@fail",
      "peek 'local::curlResult'",
      "tran '.error'",
      "flow 'actNotFound' @actNotFound @endFail",
      "@actNotFound",
      "data '0'",
      "atom",
      "done",
      "@endFail",
      "fail 'No result!'",
      "@end",
      "atom",
      "done",
      "@tokenBalance",
      "data '$symbol'",
      "case 'upper'",
      "take 4",
      "poke 'local::currency'",
      "data {'id': 2,'command': 'account_lines','account': '$1', 'ledger_index': 'current'}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran '.status' 1 @fail",
      "flow 'success' 1 @fail",
      "data {'id': 2,'command': 'account_lines','account': '$1', 'ledger_index': 'current'}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran '.result.lines' @lines @fail",
      "@lines",
      "find {'currency':'$local::currency'} @currency @fail",
      "@currency",
      "each data 'balance_currency'",
      "math",
      "atom",
      "done"
    ],
    "balance_currency" : [
      "tran '.value.balance' 1 @fail",
      "jump @end",
      "@fail",
      "fail 'No result'",
      "@end",
      "done"
    ],
    "factor" : [
      "pass '$factor'"
    ],
    "contract" : [
      "pass '$contract'"
    ],
    "cron" : [
      "data $symbol",
      "flow 'xrp' 2 1",
      "done",
      "data {'id': 1,'command': 'server_info'}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran '.status' @status @fail",
      "@status",
      "flow 'success' @getFee @fail",
      "@fail",
      "fail 'No result!'",
      "@getFee",
      "data {'id': 1,'command': 'server_info'}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran '.result.info.load_factor' @fee @fail",
      "@fee",
      "poke 'local::load_factor'",
      "math '$xrp::fee * $local::load_factor'",
      "poke 'local::fee'",
      "done"
    ],
    "fee" : [
      "data '$local::fee'",
      "flow 'undefined' @xrpFee @localFee",
      "@xrpFee",
      "pass '$xrp::fee'",
      "done()",
      "@localFee",
      "pass '$local::fee'",
      "done()"
    ],
    "push" : [
      "data '$1'",
      "curl 'asset://$symbol' '' 'POST'",
      "poke 'local::errorMessage'",
      "tran '.error' @txFail @success",
      "@txFail",
      "fail '$local::errorMessage'",
      "@success",
      "tran '.result.tx_json.hash' @succes2 @fail",
      "@success2",
      "pass"
    ],
    "transaction" : [
      "data {'id': 1,'command': 'tx','transaction': '$1','binary': false}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran {id:'=.result.Sequence|unknown',fee:'=.result.Fee|unknown',timestamp:'=.result.date|unknown',symbol:'XRP',amount:'=.result.Amount|unknown',source:'=.result.Account|unknown',target:'=.result.Destination|unknown',confirmed:'FIXME'} @succes @fail",
      "@fail",
      "fail 'error'",
      "@succes",
      "pass"
    ],
    "unspent" : [
      "data {'id': 2,'command': 'account_info','account': '$1','strict': true,'ledger_index': 'current','queue': true}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran '.result.account_data.Sequence' @next @fail",
      "@next",
      "poke 'local::sequence'",
      "data {'id': 'client id 1','method': 'server_state'}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran '.result.state.validated_ledger.seq' @next2 @fail",
      "@next2",
      "math '+4'",
      "poke 'local::ledgerSeq'",
      "peek 'local::sequence'",
      "tran {lastLedgerSequencePlus: '$local::ledgerSeq', sequence: '$local::sequence'} 1 @fail",
      "done",
      "@fail",
      "tran '.error'",
      "flow 'actNotFound' @actNotFound @endFail",
      "@actNotFound",
      "data {lastLedgerSequencePlus: '0', sequence: '0'}",
      "done",
      "@endFail",
      "fail 'No result!'"
    ],
    "sample" : [
      "pass({address:'rbwE6wsxzYat1YyGGxzAwq6wBSF5MdoAg',transaction:'699C005DEA8638B6FFEDB6039A82EB4190E0BAFAAA6E14307042FBA089E93EFE'})"
    ],
    "subhistory" : [
      "tran '.value' @next @fail",
      "@next",
      "poke 'local::subhistoryData'",
      "tran '.tx.TransactionType'",
      "flow 'Payment' @next2 @fail",
      "@next2",
      "peek 'local::subhistoryData'",
      "tran '.tx.hash' @succes @fail",
      "@fail",
      "fail 'No result!'",
      "@succes",
      "pass"
    ],
    "history" : [
      "data {'id': 2, 'command': 'account_tx', 'account': '$1', 'ledger_index_min': -1, 'ledger_index_max': -1, 'binary': false, 'limit': 10, 'forward': false}",
      "curl 'asset://$symbol' '' 'POST'",
      "tran '.result.transactions' @next @fail",
      "@fail",
      "fail 'No result!'",
      "@next",
      "each $data 'subhistory'",
      "sort(data,['obj:timestamp','num','desc'])",
      "pass"
    ],
    "test" :[
      "done {hash:4E5C0B7F, unspent:{lastLedgerSequencePlus:46084264,sequence:759}}"
    ],
    "validate" : [
      "data '$1'",
      "regx '^r[rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz]{27,35}$$' @success @fail",
      "@success",
      "done 'valid'",
      "@fail",
      "done 'invalid'"
    ]
  }
}
